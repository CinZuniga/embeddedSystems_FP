<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distance Monitor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        .landing-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
        }

        .landing-image {
            max-width: 300px;
            margin-bottom: 20px;
        }

        .landing-button {
            background-color: #ff69b4;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            text-decoration: none;
        }

        .landing-button:hover {
            background-color: #ff1493;
        }
    </style>
</head>

<body>
    <div class="landing-container">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTNqH-IZDaWEPzAzr3pN8f7Rb7_FsMOum0SZbJgMtgJlK5FNLQ_SoMyhhVdCgyC-wkrB80&usqp=CAU"
            alt="Distance Icon" class="landing-image">
        <h1>Distance Monitor</h1>
        <a href="{{ url_for('set_name') }}" class="landing-button">Set Name</a>
        <a href="{{ url_for('monitor') }}" class="landing-button">Monitor</a>
        <a href="{{ url_for('about_page') }}" class="landing-button">About</a>
    </div>
</body>

</html>

from flask import Flask, render_template, request, jsonify, redirect, url_for
from datetime import datetime
import json

app = Flask(__name__)

@app.route('/')
def landing_page():
    return render_template('landing.html')

@app.route('/set_name', methods=['GET', 'POST'])
def set_name():
    if request.method == 'POST':
        try:
            name = request.form['name']
            print(f"Name received: {name}")  # Debugging line
            return redirect(url_for('monitor', person=name))
        except Exception as e:
            print(f"Error in set_name: {e}")
            return "An error occurred in set_name", 500
    return render_template('set_name.html')

@app.route("/monitor")
def monitor():
    person = request.args.get('person', "Cinthya")  # Default name is Cinthya
    print(f"Person in monitor: {person}")  # Debugging line
    data = []

    try:
        with open('data.txt', 'r') as f:
            for line in f:
                parts = line.strip().split(',')
                if len(parts) == 2:
                    dt, distance = parts
                    data.append({
                        'datetime': dt,
                        'distance': float(distance)
                    })
    except FileNotFoundError:
        data = []

    # Limit to last 10 entries
    data = data[-10:]
    return render_template('monitor.html', data=data, person=person)

@app.route("/data/append")
def data_append():
    try:
        dt = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        dist = request.args.get('dist')
        
        if not dist:
            return jsonify({"error": "Missing distance parameter"}), 400
        
        try:
            dist = float(dist)
        except ValueError:
            return jsonify({"error": "Invalid distance value"}), 400

        with open('data.txt', 'a') as f:
            f.write(f"{dt},{dist}\n")
        
        return jsonify({"message": "Data appended successfully",
                       "datetime": dt,
                       "distance": dist})
    
    except Exception as e:
        return jsonify({"error": str(e)}), 500

@app.route("/about")
def about_page():
    return render_template('about.html')

if __name__ == '__main__':
    app.run(debug=True)